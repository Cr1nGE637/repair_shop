{% extends 'base.html' %}

{% block title %}–†–µ–º–æ–Ω—Ç #{{ repair.id }} - –†–µ–º–æ–Ω—Ç–Ω–∞—è –º–∞—Å—Ç–µ—Ä—Å–∫–∞—è{% endblock %}

{% block content %}
<h1>–†–µ–º–æ–Ω—Ç #{{ repair.id }}</h1>

<div style="display: flex; gap: 1rem; margin: 1rem 0;">
    <a href="{% url 'repair:repair_list' %}" class="btn">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
    <a href="/admin/repair/repair/{{ repair.id }}/change/" class="btn">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
    {% if repair.status == 'ready' or repair.status == 'completed' %}
    <a href="{% url 'repair:repair_act' repair.id %}" class="btn btn-success">üìÑ –ê–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç</a>
    {% endif %}
</div>

<h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–º–æ–Ω—Ç–µ</h2>
<table>
    <tr>
        <th>–¢–µ—Ö–Ω–∏–∫–∞</th>
        <td>{{ repair.device }}</td>
    </tr>
    <tr>
        <th>–ö–ª–∏–µ–Ω—Ç</th>
        <td>{{ repair.device.client.full_name }}</td>
    </tr>
    <tr>
        <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
        <td>{{ repair.device.client.phone }}</td>
    </tr>
    <tr>
        <th>–°—Ç–∞—Ç—É—Å</th>
        <td>
            <span class="status-badge status-{{ repair.status }}">
                {{ repair.get_status_display }}
            </span>
        </td>
    </tr>
    <tr>
        <th>–ü—Ä–æ–±–ª–µ–º–∞ (—Å–æ —Å–ª–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞)</th>
        <td>{{ repair.problem_description }}</td>
    </tr>
    <tr>
        <th>–î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞</th>
        <td>{{ repair.accepted_at|date:"d.m.Y H:i" }}</td>
    </tr>
    {% if repair.started_at %}
    <tr>
        <th>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç</th>
        <td>{{ repair.started_at|date:"d.m.Y H:i" }}</td>
    </tr>
    {% endif %}
    {% if repair.completed_at %}
    <tr>
        <th>–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è</th>
        <td>{{ repair.completed_at|date:"d.m.Y H:i" }}</td>
    </tr>
    {% endif %}
    {% if repair.issued_at %}
    <tr>
        <th>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏</th>
        <td>{{ repair.issued_at|date:"d.m.Y H:i" }}</td>
    </tr>
    {% endif %}
    <tr>
        <th>–ú–∞—Å—Ç–µ—Ä</th>
        <td>{{ repair.created_by.get_full_name|default:repair.created_by.username }}</td>
    </tr>
    {% if repair.master_notes %}
    <tr>
        <th>–ó–∞–º–µ—Ç–∫–∏ –º–∞—Å—Ç–µ—Ä–∞</th>
        <td>{{ repair.master_notes }}</td>
    </tr>
    {% endif %}
</table>

<h2 style="margin-top: 2rem;">–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</h2>
{% if works %}
<table>
    <thead>
        <tr>
            <th>–í–∏–¥ —Ä–∞–±–æ—Ç—ã</th>
            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
            <th>–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É</th>
            <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
            {% if works.0.notes %}
            <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
        {% for work in works %}
        <tr>
            <td>{{ work.work_type.name }}</td>
            <td>{{ work.quantity }}</td>
            <td>{{ work.unit_price }} —Ä—É–±.</td>
            <td><strong>{{ work.cost }} —Ä—É–±.</strong></td>
            {% if work.notes %}
            <td>{{ work.notes }}</td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>–†–∞–±–æ—Ç—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã.</p>
{% endif %}

<h2 style="margin-top: 2rem;">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã</h2>
{% if components %}
<table>
    <thead>
        <tr>
            <th>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç</th>
            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
            <th>–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É</th>
            <th>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</th>
            <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
            {% if components.0.notes %}
            <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
        {% for comp in components %}
        <tr>
            <td>{{ comp.component.name }}</td>
            <td>{{ comp.quantity }}</td>
            <td>{{ comp.unit_price }} —Ä—É–±.</td>
            <td><strong>{{ comp.total_cost }} —Ä—É–±.</strong></td>
            <td>{% if comp.was_purchased %}–ó–∞–∫—É–ø–ª–µ–Ω{% else %}–°–æ —Å–∫–ª–∞–¥–∞{% endif %}</td>
            {% if comp.notes %}
            <td>{{ comp.notes }}</td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å.</p>
{% endif %}

<div style="margin-top: 2rem; padding: 1rem; background-color: #f8f9fa; border-radius: 4px;">
    <h3 style="margin-bottom: 0.5rem;">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ–º–æ–Ω—Ç–∞:</h3>
    <p style="font-size: 1.5rem; font-weight: bold; color: #27ae60;">{{ repair.total_cost }} —Ä—É–±.</p>
</div>
{% endblock %}

